<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Face Verify</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body style="margin:0; font-family:'Segoe UI',Arial,sans-serif; background:url('https://images.unsplash.com/photo-1465101046530-73398c7f28ca?auto=format&fit=crop&w=1500&q=80') no-repeat center center fixed; background-size:cover;">
  <div style="background:rgba(255,255,255,0.93); max-width:720px; margin:48px auto; border-radius:18px; box-shadow:0 4px 32px #0002; padding:40px 32px; animation:fadein 1.2s; text-align:center;">
  <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Bank Logo" style="width:60px; margin-bottom:18px; filter:drop-shadow(0 2px 6px #0002); display:block; margin-left:auto; margin-right:auto;">
    <h2 style="font-weight:700; margin-bottom:24px; color:#1a237e;">Login - Face Verification</h2>
    <video id="video" width="640" height="480" autoplay muted style="border-radius:10px; border:1px solid #bbb; margin-bottom:18px; box-shadow:0 2px 8px #0001; max-width:100%; height:auto;"></video>
    <div style="margin-bottom:18px;"></div>
    <button id="snap" style="padding:14px 28px; background:#1976d2; color:#fff; border:none; border-radius:8px; font-weight:600; font-size:1em; box-shadow:0 2px 8px #1976d233; cursor:pointer; transition:background 0.2s; margin-bottom:12px;">Capture & Verify</button>
    <div id="result" style="margin-top:18px; font-size:1.1em; font-weight:500; color:#d32f2f;"></div>
    <a href="/" style="padding:12px 24px; background:#6c757d; color:#fff; border-radius:8px; text-decoration:none; font-weight:500; display:inline-block; margin-top:18px;">Home</a>
  </div>
  <style>
    @keyframes fadein { from { opacity:0; transform:translateY(30px);} to { opacity:1; transform:none; } }
    button:hover, a:hover { filter:brightness(1.08); }
  </style>
  <script src="/static/webcam.js"></script>
  <script>
  // Start webcam with higher resolution
  startWebcam("video", 640, 480);
  
  document.getElementById("snap").onclick = function() {
    const snapBtn = document.getElementById("snap");
    const resultDiv = document.getElementById("result");
    
    // Disable button and show loading state
    snapBtn.disabled = true;
    snapBtn.innerText = "Capturing...";
    resultDiv.innerText = "Preparing to capture...";
    resultDiv.style.color = "#1976d2";
    
    // Capture with higher resolution for better face recognition
    captureImage("video", function(dataURL) {
      resultDiv.innerText = "Verifying face...";
      
      fetch("/api/verify", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({image: dataURL})
      })
      .then(r => r.json())
      .then(j => {
        if(j.name && j.name !== "unknown") {
          var userId = j.name;
          resultDiv.innerText = "✅ Welcome, User: " + userId + "! Redirecting...";
          resultDiv.style.color = "#43a047";
          setTimeout(function() {
            window.location.href = "/login_pin";
          }, 2000);
        } else if(j.error) {
          resultDiv.innerText = "❌ " + j.error;
          resultDiv.style.color = "#d32f2f";
          // Re-enable button
          snapBtn.disabled = false;
          snapBtn.innerText = "Capture & Verify";
        } else {
          resultDiv.innerText = "❌ No face matched. Please try again.";
          resultDiv.style.color = "#d32f2f";
          // Re-enable button
          snapBtn.disabled = false;
          snapBtn.innerText = "Capture & Verify";
        }
      })
      .catch(err => {
        resultDiv.innerText = "❌ Request error: " + err;
        resultDiv.style.color = "#d32f2f";
        // Re-enable button
        snapBtn.disabled = false;
        snapBtn.innerText = "Capture & Verify";
      });
    }, 640, 480);
  };
  
  // Clean up camera when page unloads
  window.addEventListener('beforeunload', function() {
    stopWebcam("video");
  });
  </script>
</body>
</html>
